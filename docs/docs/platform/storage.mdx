---
title: 'Storage'
sidebar_position: 7
image: /img/og/platform/storage.png
---

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

Nhost Storage enables you to let your users upload and download files.

## Files

Files can be of any type, such as images, documents, videos, etc.

File metadata is stored in your database in the `files` table in the `storage` schema. This means that file metadata is available in your GraphQL API, which makes it easy to:

- Read file metadata via GraphQL.
- Manage file permissions (in Hasura).
- Create GraphQL relationships between files and your custom tables.

:::warning
Don't modify the database schema, nor GraphQL root fields in any of the tables in the `storage` schema. 
:::

:::tip
You're allowed to add and modify the following:

- GraphQL Relationships
- Permissions
:::


### Upload File

When a file is uploaded, the file metadata is inserted into the `storage.files` table and a file `id` is returned.  The file's `id` is how you reference the file in the future. It's recommended to create your own table to store the uploaded file `id`, so you can access the file in the future.

### Download File

There are two ways to download a file:

- Public URL.
- Pre-signed URL.

#### Public URL

To access a file, make an HTTP GET request to `/v1/storage/files/{id}` with the `Authorization` header set with the access token returned by Nhost Auth. Alternatively, you can create a pre-signed URL by making an HTTP GET request to `/v1/storage/files/{id}/presignedurl` with the `Authorization` header set with the access token returned by Nhost Auth.


If the file is publicly accessible, there is no need to set the `Authorization` header. The file is publicly accessible if the permission for the `public` role is set to allow reading the file metadata in Hasura for the `storage.files` table.

#### Pre-signed URL

A pre-signed URL is a unique URL that is used to access the file. Anyone with the pre-signed URL can access the file without exceptions. The URL is generated by Nhost Storage API and is valid for a limited time. The time limit of the pre-signed URL is determined by the `download_expiration` column in the bucket where the file is.

Using pre-signed URL is a good way to share files to people who don't have access to the file directly, or to access the file without setting the `Authorization` headers, for example when displaying the file in an `img` tag.

### Delete File

asdasd

<Tabs groupId="http-sdk">
  <TabItem value="js" label="JavaScript">

```js
const { error } = await nhost.storage.delete({ fileId: 'uuid' })
```

Learn more about our [JavaScript SDK](/reference/javascript/storage/delete).

  </TabItem>
  <TabItem value="http" label="http" default>

```http
DELETE /v1/storage/files/{file_id} HTTP/1.1
```

  </TabItem>
</Tabs>

## Buckets

Buckets are used to organize files and group permissions for files. Buckets are stored in the `storage.buckets` table in your database, and accessible via `buckets` in your GraphQL API.

For each bucket, you can specify file permissions for things like:

- MIME type.
- Minimum size.
- Maximum size.
- Cache control.
- Allow pre-signed URLs.
- Download expiration (for pre-signed URLs).

There is a default bucket (`default`) that is used if no bucket is specified during file upload. It's not possible to delete the `default` bucket.

## Permissions

Permissions to Upload, Access (Download), and Delete files are managed through Hasura's permission system for the `storage.files` table.

### Upload

To upload a file, a user must have the **`insert` permission** to the `storage.files` table. The following columns must be allowed to insert

- `id`
- `bucket_id`
- `name`
- `mime_type`

### Download

To download a file, a user must have the **`select` permission** to the `storage.files` table. Only the `id` column is required, but as a best practice you should allow reading all file columns.

### Delete

To delete a file, a user must have the **`delete` permission** to the `storage.files` table.

Updating an existing file is not supported. If you need to update a file, delete the file and upload a new file.

Just deleting the file metadata in the `storage.files` table does **not** delete the actual file. Instead, always delete files via Nhost Storage. This way, both the file metadata and actual file are deleted.

## Image Transformation

Images can be transformed, on the fly, by adding query parameters. The following query parameters are available:

- `w` - Width of the image in pixels.
- `h` - Height of the image in pixels.

Image Transformation works on both public and pre-signed URLs.

**Example**: Set the width of an image to 500px width (`?w=500`):

```text
https://[subdomain].nhost.run/v1/storage/files/08e6fa32-0880-4d0e-a832-278198acb363?w=500
```


## Example: CRM System

Let's say we're building a CRM and we want to store files for each customer.

In our CRM, we have the following two tables:

```text
- customers
  - id
  - name
  - address
- customer_files
  - id
  - customer_id (foreign key to `customers.id`)
  - file_id (foreign key to `storage.files.id`)
```

We also have created relationships between `customers` and `customer_files` and between `customer_files` and `storage.files`.

We can now query the data with the following query:

```graphql
query {
  customer {
    # customer table
    id
    name
    customer_files {
      # customer_files table
      id
      file {
        # storage.files table
        id
        name
        size
        mime_type
      }
    }
  }
}
```

To upload a file, this is what we do;

1. Upload a file
2. Get the `id` of the file. The server returns this.
3. Insert the `id` of the file together with the customer's id into the `customer_files` table.
